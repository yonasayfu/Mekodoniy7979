# Mekodonia Home Connect Overview (Presentation Notes)

This deck summarizes the current build so you can paste each section into PowerPoint/Google Slides. Each block reads like a slide: headline, bullet list, and file references for follow-up.

Next: when you build the actual slides, consider sprinkling in a couple of screenshots (guest form, dashboard card, notification bell) and rehearse the demo steps listed in the final section; let me know if you’d like a version with speaker notes or export-ready text.
---

## Mission & Flow
- **Vision:** The welcome page, guest form, and admin ops present a single path—guests explore elders, pledge via Telebirr or bank, receive login credentials, and admins reconcile via notifications and dashboards.
- **Flow summary:**
  1. Visitors land on `/` (filters, curated hero cards, and elder spotlight CTAs) and are routed to `/guest-donation` with `relationship`, `elder_id`, and `mode` thanks to `resources/js/pages/Welcome.vue`.
  2. `GuestDonation.vue` pre-fills context, captures amount/name/phone/notes, offers Telebirr QR or bank instructions, uploads receipts/mandates, and generates a `payment_reference` for later lookups.
  3. On submit `DonationController::storeGuest` validates through `StoreDonationRequest`, stores cadence/recurrence/deduction metadata, creates/updates the `User` and `DonorProfile`, writes receipt/mandate paths, and fires `GuestDonationLoggedNotification`.
  4. The thank-you view (`resources/js/pages/ThankYou.vue`) shows cadence/payment status, receipt/mandate links, autogenerated member credentials, and shortcuts to “My donations” or “Manage my pledge.”
- **Payment metadata:** Kerr the `donations` table (`app/Models/Donation.php` plus migrations `2026_03_12_* / 2026_03_13_* / 2026_03_14_*`) tracks `cadence`, `deduction_schedule`, `payment_status`, `mandate_path`, and `payment_reference` so finance can reconcile recurring deductions.

---

## Welcome Page & Guest Form
- **Hero & CTA wiring:** Each hero quick action, relationship badge, and elder card routes users to the guest form with seeded query params (see `resources/js/pages/Welcome.vue:191-260`). The “Sponsor this elder” button now passes the elder context so the backend receives `elder_id`, `relationship`, and `mode` automatically.
- **Form experience:** `GuestDonation.vue` exposes:
  - Relationship pills with copy + ability to clear selections.
  - Mode toggle (One-time vs Sponsorship) that adjusts cadence defaults.
  - Telebirr QR plus bank account grid (loaded from `paymentOptions` via the `/guest-donation` route).
  - Receipt and mandate upload handlers storing files in `storage/app/public/receipts`.
  - Payment reference generator + “Regenerate reference” control for matching Telebirr/bank replies.
  - Prefill logic (`donations.prefill` endpoint) so `/guest-donation?payment_reference=XYZ` reloads data when authenticated.
- **Backend enforcement:** `StoreDonationRequest` demands `name` & `phone` (now required to back the auto-membership), `DonationController::ensureGuestMember` builds a member (fallback email `guest+PHONE@mekodonia.local` when missing), syncs `DonorProfile`, and threads the member password into the thank-you payload and notification.

---

## Donor Self-Service
- **History page:** `DonorDonationsController` (new controller) returns the latest 20 pledges with elder name, cadence, deduction schedule, payment reference, receipt/mandate URLs, and a `manage_url` pointing to `/guest-donation?payment_reference=…`.
- **UI:** `resources/js/pages/DonorDonations.vue` renders each pledge with badges, receipt/mandate downloads, and “Manage pledge” buttons so donors can reopen a pledge after login.
- **Dashboard CTA:** `DonorDashboardController` now provides a “Manage my latest pledge” link plus a helper line pointing to `/donors/donations`, and the dashboard UI includes action pills for donors to jump between history and editing.
- **Thank-you helpers:** The thank-you view reiterates cadence, payment method, payment status, and links to “Manage my pledge” (when a reference exists) plus “View my donations.” It also displays credentials (phone/password) so donors can log into the member DASH.

---

## Admin Side & Notifications
- **Pending donations card:** `resources/js/pages/Dashboard.vue` now loads pending guest donations with funding progress bars, receipt/mandate downloads, and a “Confirm payment” button that calls `DonationController::confirmGuestPayment` (sending receipts via `DonationReceiptService`).
- **Notifications:** `GuestDonationLoggedNotification` includes cadence, deduction schedule, branch, elder funding stats, proof URLs, and now links to `route('sponsorships.index')` so clicking the bell lands staff in the sponsorship approvals table. The bell dropdown (`NotificationBell.vue`) and notifications list (`Notifications/Index.vue`) mirror the dashboard’s metadata and let admins confirm payments right from the list.
- **Sponsorship controller:** `SponsorshipController::index` feeds `Sponsorships/Index.vue` with search/filter-ready data, pending pre-sponsorships, and stats; the sponsorship list sits at `routes/web.php` under `/sponsorships` with pagination.
- **Approval flow:** Clicking a notification → `/sponsorships` → selecting a sponsorship role allows admins to match elders, confirm payments, and trigger timeline events.

---

## Backend Highlights
- **Core controllers & services:**
  - `DonationController`: guest donation creation (with member creation, receipt generation, notifications, Telebirr webhook hooking via `Payments/TelebirrWebhookController`).
  - `DonorDonationController`: donor history and manage URLs.
  - `DashboardController`: aggregates pending donations and relevant stats for the admin card.
  - `SponsorshipController`: sponsorship directory, approvals, data exports, `timeline events` on creation.
- **Notifications & webhooks:**
  - `GuestDonationLoggedNotification` now redirects to the sponsorship index and includes file links.
  - Telebirr webhook updates `payment_status`/`payment_id` and can trigger `GuestDonationReceiptNotification` when finance confirms a transfer.
  - Manual confirmation via `DonationController::confirmGuestPayment` sends receipts to donors, updates statuses, and refreshes the dashboard.
- **Seeds & data:** Branch, staff, elder, and guest-donation seeders cap entries at 3 so dashboards/notification cards stay tidy during demos; run `php artisan db:seed` to refresh test data. `tests/Feature/GuestPaymentFlowTest.php` covers Telebirr/bank guest submissions.

---

## Presentation Tips
1. **Live demo idea:** Show the welcome page → click an elder → fill the guest form with Telebirr or bank upload → land on the thank-you page, highlight the credentials, and click “Manage my pledge.”
2. **Admin story:** Show the dashboard card with pending donation(s), open the notification bell (or list), click a guest donation notification, land on `/sponsorships`, and click “Confirm payment” to send a receipt.
3. **Files to reference:** Mention `app/Http/Controllers/DonationController.php`, `GuestDonation.vue`, `DonorDonations.vue`, `Dashboard.vue`, `NotificationBell.vue`, `SponsorshipController.php`, and `resources/js/pages/Sponsorships/Index.vue` in your narrative.
4. **Closing:** Highlight the controlled seed data, manual testing approach, existing tests, and how the donor history + manage link fulfill the “guest → member → tracked donor” goal.
